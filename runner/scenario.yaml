constants:
  tangoClassic:
    - data/tango-classic-1.mp3
  tangoCrade:
    - data/tango-crade-1.mp3
    - data/tango-crade-2.mp3
  voix:
    - data/voix-1.mp3
  proutes:
    - data/proutes/1.mp3
    - data/proutes/2.mp3
    - data/proutes/3.mp3
    - data/proutes/4.mp3
    - data/proutes/5.mp3
    - data/proutes/6.mp3
    - data/proutes/7.mp3
    - data/proutes/8.mp3
    - data/proutes/9.mp3
    - data/proutes/10.mp3

  lockerPinNum: 21
  lockerPinLowEvent: busy
  lockerPinHighEvent: idle

  relay1PinNum: 14
  relay1PinValueBusy: 1
  relay1PinValueIdle: 0

  relay2PinNum: 10
  relay3PinNum: 9


events:

  _START_:
    type: sequence
    group:
    - type: pinInit
      num: $lockerPinNum
      direction: in
      edge: both
      pull: up

    - type: pinInit
      num: 14
      direction: out
    - type: pinInit
      num: 15
      direction: out
    - type: suspend
      event: busy
      suspend: false
    - type: suspend
      event: idle
      suspend: true
    - type: pinMonitor
      num: $lockerPinNum
      persist: true
      high:
        type: emit
        event: $lockerPinHighEvent
      low:
        type: emit
        event: $lockerPinLowEvent


  busy:
    type: killAll
    then:
      type: sequence
      group:
      - type: parallel
        group:
        - type: suspend
          event: busy
          suspend: true
        - type: suspend
          event: idle
          suspend: false
        - type: pinOutput
          num: 14
          value: 1
        - type: pinOutput
          num: 15
          value: 1
        - type: audio
          track:
            function: randomChoice
            choices: $tangoClassic
          repeat: false
          timeout: 10
        - type: timer
          seconds: 10
          action:
            type: sequence
            group:
            - type: audio
              track:
                function: randomChoice
                choices: $voix
              repeat: false
            - type: audio
              track:
                function: randomChoice
                choices: $tangoCrade
              repeat: false
        - type: loop
          count: 'infinite'
          action:
            type: sequence
            group:
              - type: sleep
                seconds:
                  function: randomInt
                  min: 2
                  max: 10
              - type: audio
                repeat: false
                track:
                  function: randomChoice
                  choices: $proutes
                volume: 2

  idle:
    type: killAll
    then:
      type: sequence
      group:
      - type: parallel
        group:
        - type: suspend
          event: busy
          suspend: false
        - type: suspend
          event: idle
          suspend: true
      - type: pinOutput
        num: 14
        value: 0
      - type: pinOutput
        num: 15
        value: 0


